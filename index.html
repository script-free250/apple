<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Apple Of Fortune</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Ø­Ø§ÙˆÙŠØ© ØªØ­Ø§ÙƒÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ù‡Ø§ØªÙ */
        #app {
            width: 100%;
            max-width: 420px;
            height: 100vh;
            position: relative;
            background-color: #1b242d; /* Ù„ÙˆÙ† Ø§Ø­ØªÙŠØ§Ø·ÙŠ */
            background-image: url('bg.png'); /* Ù…ÙƒØ§Ù† ØµÙˆØ±ØªÙƒ */
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ) --- */
        header {
            height: 55px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            background: rgba(0,0,0,0.3);
            z-index: 10;
        }

        .header-btn {
            color: #fff;
            font-size: 20px;
            opacity: 0.8;
            cursor: pointer;
        }

        .balance-box {
            background: rgba(30, 40, 50, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 4px 12px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .coin {
            width: 16px; height: 16px;
            background: #ffc107;
            border-radius: 50%;
            box-shadow: 0 0 4px #ffc107;
        }

        .balance-text {
            color: #fff;
            font-size: 14px;
            font-weight: bold;
        }

        /* --- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ (Ø§Ù„Ø´Ø¨ÙƒØ©) --- */
        .game-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 90px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
            overflow: hidden;
        }

        .grid-container {
            display: flex;
            flex-direction: column-reverse; /* Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
            gap: 6px;
            padding: 10px;
            transform: scale(0.95); /* ØªØµØºÙŠØ± Ø¨Ø³ÙŠØ· Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø´Ø§Ø´Ø§Øª */
        }

        .row {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            padding-left: 55px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
            opacity: 0.5; /* Ø§Ù„ØµÙÙˆÙ ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·Ø© Ø¨Ø§Ù‡ØªØ© */
            transition: 0.3s;
        }

        .row.active {
            opacity: 1;
            transform: scale(1.02);
        }

        .row.active::after {
            /* ØªØ£Ø«ÙŠØ± Ø§Ù„ÙˆÙ‡Ø¬ Ø®Ù„Ù Ø§Ù„ØµÙ Ø§Ù„Ù†Ø´Ø· */
            content: '';
            position: absolute;
            left: 0; top: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            pointer-events: none;
        }

        /* ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… (Odds) */
        .odds-pill {
            position: absolute;
            left: 0;
            width: 50px;
            padding: 3px 0;
            background: #11181f;
            color: #6c7a89;
            font-size: 11px;
            font-weight: bold;
            text-align: center;
            border-radius: 10px;
            border: 1px solid #2c3e50;
        }

        .row.active .odds-pill {
            color: #fff;
            border-color: #7cb342;
            background: #1e2a1e;
            box-shadow: 0 0 5px rgba(124, 179, 66, 0.4);
        }

        /* --- Ø§Ù„Ø®Ù„ÙŠØ© (Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø®Ø´Ø¨ÙŠØ©) --- */
        .cell {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            
            /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ù€ CSS Ù„ØªØ´Ø¨Ù‡ Ø§Ù„Ø®Ø´Ø¨ */
            background: radial-gradient(circle at 40% 40%, #5d4037, #3e2723 60%, #1a100c 95%);
            border: 2px solid #281914;
            box-shadow: 0 4px 6px rgba(0,0,0,0.6), inset 0 2px 5px rgba(255,255,255,0.1);
        }

        .cell:active { transform: scale(0.92); }

        /* Ø§Ù„ØµÙˆØ±Ø© (Ø§Ù„ØªÙØ§Ø­Ø©) */
        .cell img {
            width: 85%;
            height: 85%;
            object-fit: contain;
            display: none;
            z-index: 2;
            filter: drop-shadow(0 5px 3px rgba(0,0,0,0.5));
            animation: popUp 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .cell.revealed img { display: block; }

        @keyframes popUp {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* --- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³ÙÙ„ÙŠØ© --- */
        .controls {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #212b36;
            padding: 12px 15px;
            border-top: 1px solid rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 20;
        }

        .bet-input-group {
            display: flex;
            justify-content: space-between;
            background: #161f28;
            border-radius: 8px;
            padding: 4px;
            border: 1px solid #2c3844;
        }

        .bet-btn-small {
            width: 40px;
            height: 40px;
            background: #2c3844;
            border: none;
            color: #fff;
            font-size: 18px;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .bet-btn-small:active { background: #394855; }

        input[type="number"] {
            background: transparent;
            border: none;
            color: #fff;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            width: 100px;
            outline: none;
        }
        
        /* Ø²Ø± Ø§Ù„Ø±Ù‡Ø§Ù† Ø§Ù„ÙƒØ¨ÙŠØ± Ø§Ù„Ø£Ø®Ø¶Ø± */
        .main-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            color: #fff;
            cursor: pointer;
            transition: 0.1s;
            background: linear-gradient(180deg, #9ccc65 0%, #558b2f 100%);
            box-shadow: 0 3px 0 #33691e;
        }

        .main-btn:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0 #33691e;
        }

        .cashout-style {
            background: linear-gradient(180deg, #ffca28 0%, #ff6f00 100%);
            box-shadow: 0 3px 0 #e65100;
            color: #212121;
        }

        .cashout-style:active { box-shadow: 0 1px 0 #e65100; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(2px);
        }

        .modal-box {
            background: #263238;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            width: 280px;
            border: 1px solid #37474f;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .modal-title { color: #fff; font-size: 22px; margin-bottom: 5px; }
        .modal-amount { color: #9ccc65; font-size: 26px; font-weight: bold; }
        .modal-sub { color: #90a4ae; font-size: 12px; margin-top: 15px; }

    </style>
</head>
<body>

    <div id="app">
        <header>
            <div class="header-btn">â®</div>
            <div class="balance-box">
                <div class="coin"></div>
                <div class="balance-text" id="balanceDisplay">1000.00 EGP</div>
            </div>
            <div class="header-btn">â˜°</div>
        </header>

        <div class="game-area">
            <div class="grid-container" id="grid">
                </div>
        </div>

        <div class="controls">
            <div class="bet-input-group">
                <button class="bet-btn-small" onclick="adjustBet(-5)">-</button>
                <input type="number" id="betAmount" value="10" readonly>
                <button class="bet-btn-small" onclick="adjustBet(5)">+</button>
            </div>
            
            <button id="actionBtn" class="main-btn" onclick="handleAction()">Place a bet</button>
        </div>

        <div class="modal-overlay" id="resultModal" onclick="closeModal()">
            <div class="modal-box">
                <div class="modal-title" id="modalTitle">YOU WON!</div>
                <div class="modal-amount" id="modalAmount">12.30 EGP</div>
                <div class="modal-sub">Tap to continue</div>
            </div>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        const ROWS = 10;
        const COLS = 5;
        // Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø¨Ø­ (1xBet Standard Odds)
        const ODDS = [1.23, 1.54, 1.93, 2.41, 4.02, 6.71, 11.18, 27.96, 69.91, 349.54];

        // Ø§Ù„Ø­Ø§Ù„Ø©
        let balance = 1000.00;
        let currentBet = 10;
        let activeRow = 0;
        let isPlaying = false;
        let bombsMap = []; // Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„

        // Ø§Ù„Ø¹Ù†Ø§ØµØ±
        const gridEl = document.getElementById('grid');
        const actionBtn = document.getElementById('actionBtn');
        const balanceEl = document.getElementById('balanceDisplay');
        const betInput = document.getElementById('betAmount');
        const modal = document.getElementById('resultModal');

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„ÙˆØ­Ø©
        function initGrid() {
            gridEl.innerHTML = '';
            for (let r = 0; r < ROWS; r++) {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙ
                const row = document.createElement('div');
                row.className = 'row';
                row.id = `row-${r}`;

                // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª (ÙŠØ³Ø§Ø±)
                const oddPill = document.createElement('div');
                oddPill.className = 'odds-pill';
                oddPill.innerText = 'x' + ODDS[r];
                row.appendChild(oddPill);

                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ (5 Ø®Ù„Ø§ÙŠØ§)
                for (let c = 0; c < COLS; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.onclick = () => onCellClick(r, c);
                    
                    // Ø§Ù„ØµÙˆØ±Ø© (Ù…Ø®ÙÙŠØ©)
                    const img = document.createElement('img');
                    img.id = `img-${r}-${c}`;
                    // Ù„Ø§Ø­Ø¸: Ø§Ù„ØµÙˆØ± ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙŠ Ø³ØªØ±ÙØ¹Ù‡Ø§
                    img.alt = ""; 
                    
                    cell.appendChild(img);
                    row.appendChild(cell);
                }
                gridEl.appendChild(row);
            }
        }

        // Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø±Ù‡Ø§Ù† Ø£Ùˆ Ø³Ø­Ø¨)
        function handleAction() {
            if (!isPlaying) {
                startGame();
            } else {
                cashOut();
            }
        }

        function startGame() {
            if (currentBet > balance) {
                alert("Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠ!");
                return;
            }

            // Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯ ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
            balance -= currentBet;
            updateUI();
            
            isPlaying = true;
            activeRow = 0;
            generateBombs();
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø´Ø¨ÙƒØ© Ù†Ø¸ÙŠÙØ©
            resetVisuals();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø²Ø±
            actionBtn.style.display = 'none'; // ÙŠØ®ØªÙÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨ Ø­ØªÙ‰ Ø§Ù„ÙÙˆØ² Ø¨Ø£ÙˆÙ„ Ù…Ø±Ø­Ù„Ø©
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„
            activateRow(0);
        }

        function generateBombs() {
            bombsMap = [];
            for (let r = 0; r < ROWS; r++) {
                // Ù…Ù†Ø·Ù‚ Ø§Ù„ØµØ¹ÙˆØ¨Ø©:
                // Ø§Ù„ØµÙÙˆÙ 0-3: Ù‚Ù†Ø¨Ù„Ø© ÙˆØ§Ø­Ø¯Ø©
                // Ø§Ù„ØµÙÙˆÙ 4-6: Ù‚Ù†Ø¨Ù„ØªØ§Ù†
                // Ø§Ù„ØµÙÙˆÙ 7-8: 3 Ù‚Ù†Ø§Ø¨Ù„
                // Ø§Ù„ØµÙ 9: 4 Ù‚Ù†Ø§Ø¨Ù„
                let bombCount = 1;
                if(r >= 4) bombCount = 2;
                if(r >= 7) bombCount = 3;
                if(r >= 9) bombCount = 4;

                let rowArr = Array(COLS).fill('apple');
                for(let k=0; k<bombCount; k++) {
                    let placed = false;
                    while(!placed) {
                        let idx = Math.floor(Math.random() * COLS);
                        if(rowArr[idx] === 'apple') {
                            rowArr[idx] = 'rotten';
                            placed = true;
                        }
                    }
                }
                bombsMap.push(rowArr);
            }
        }

        function onCellClick(r, c) {
            if (!isPlaying || r !== activeRow) return;

            const cellImg = document.getElementById(`img-${r}-${c}`);
            const cellDiv = cellImg.parentElement;

            if (cellDiv.classList.contains('revealed')) return;

            // ÙƒØ´Ù Ø§Ù„Ø®Ù„ÙŠØ©
            cellDiv.classList.add('revealed');
            
            if (bombsMap[r][c] === 'apple') {
                // ÙÙˆØ²
                cellImg.src = 'apple.png';
                // Ù„Ùˆ Ù…Ø§ÙÙŠØ´ ØµÙˆØ±Ø©ØŒ Ø­Ø· Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                cellImg.onerror = () => { cellDiv.innerHTML = '<span style="font-size:24px">ğŸ</span>'; };
                
                winLevel(r);
            } else {
                // Ø®Ø³Ø§Ø±Ø©
                cellImg.src = 'rotten.png';
                cellImg.onerror = () => { cellDiv.innerHTML = '<span style="font-size:24px">ğŸ›</span>'; };
                
                gameOver();
            }
        }

        function winLevel(r) {
            // ØªØ¬Ù…ÙŠØ¯ Ø§Ù„ØµÙ Ø§Ù„Ø­Ø§Ù„ÙŠ
            const currentRowEl = document.getElementById(`row-${r}`);
            currentRowEl.classList.remove('active');
            currentRowEl.style.opacity = '1'; // ÙŠØ¨Ù‚Ù‰ Ø¸Ø§Ù‡Ø±
            
            activeRow++;

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ
            let profit = (currentBet * ODDS[r]).toFixed(2);

            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø³Ø­Ø¨
            actionBtn.style.display = 'block';
            actionBtn.innerText = `Take Winnings (${profit})`;
            actionBtn.className = 'main-btn cashout-style';

            if (activeRow >= ROWS) {
                cashOut(); // ÙÙˆØ² Ø¨Ø§Ù„Ù„Ø¹Ø¨Ø© ÙƒØ§Ù…Ù„Ø©
            } else {
                activateRow(activeRow);
            }
        }

        function gameOver() {
            isPlaying = false;
            // ÙƒØ´Ù Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„ ÙÙŠ Ø§Ù„ØµÙ
            revealRow(activeRow);
            
            setTimeout(() => {
                showModal(false, 0);
                resetGameUI();
            }, 1000);
        }

        function cashOut() {
            if (!isPlaying) return;
            
            // Ø§Ù„Ø±Ø¨Ø­ Ù‡Ùˆ Ø£ÙˆØ¯Ø² Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¨Ù‚
            let winIdx = activeRow - 1;
            let winAmount = currentBet * ODDS[winIdx];
            
            balance += winAmount;
            isPlaying = false;
            updateUI();
            
            showModal(true, winAmount);
            resetGameUI();
        }

        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        function activateRow(r) {
            const row = document.getElementById(`row-${r}`);
            row.classList.add('active');
        }

        function revealRow(r) {
            for(let c=0; c<COLS; c++) {
                const img = document.getElementById(`img-${r}-${c}`);
                const parent = img.parentElement;
                if(!parent.classList.contains('revealed')) {
                    parent.classList.add('revealed');
                    parent.style.opacity = '0.5';
                    if(bombsMap[r][c] === 'apple') img.src = 'apple.png';
                    else img.src = 'rotten.png';
                }
            }
        }

        function resetVisuals() {
            initGrid(); // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø´Ø¨ÙƒØ©
        }

        function resetGameUI() {
            actionBtn.style.display = 'block';
            actionBtn.innerText = "PLACE A BET";
            actionBtn.className = 'main-btn';
        }

        function updateUI() {
            balanceEl.innerText = balance.toFixed(2) + ' EGP';
            betInput.value = currentBet;
        }

        function adjustBet(val) {
            if(isPlaying) return;
            currentBet += val;
            if(currentBet < 1) currentBet = 1;
            updateUI();
        }

        function showModal(isWin, amount) {
            modal.style.display = 'flex';
            const title = document.getElementById('modalTitle');
            const amt = document.getElementById('modalAmount');
            
            if(isWin) {
                title.innerText = "YOU WON!";
                title.style.color = "#9ccc65";
                amt.innerText = amount.toFixed(2) + " EGP";
                amt.style.display = "block";
            } else {
                title.innerText = "GAME OVER";
                title.style.color = "#ef5350";
                amt.style.display = "none";
            }
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        // Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ
        initGrid();

    </script>
</body>
</html>
