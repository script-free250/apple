<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple of Fortune</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø³Ù… Ù„ÙŠÙƒÙˆÙ† Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ÙˆØªÙˆØ³ÙŠØ· Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #0a1118; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ† Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden; /* Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ */
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙŠ ØªØ­Ø§ÙƒÙŠ Ø­Ø¬Ù… Ø´Ø§Ø´Ø© Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        #app-container {
            width: 100%;
            max-width: 414px; /* Ø¹Ø±Ø¶ Ø£Ù‚ØµÙ‰ ÙŠØ­Ø§ÙƒÙŠ Ø§Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
            min-height: 100vh; /* ÙŠØºØ·ÙŠ Ø·ÙˆÙ„ Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
            /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø¹Ø¨Ø© - ÙŠØ±Ø¬Ù‰ ØªÙˆÙÙŠØ± ØµÙˆØ±Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© */
            background: url('bg.png') no-repeat center center;
            background-size: cover;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.7); /* Ø¸Ù„ Ø­ÙˆÙ„ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ù„ØªÙ…ÙŠÙŠØ²Ù‡Ø§ */
        }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø§Ù„Ø±ØµÙŠØ¯ ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù†) --- */
        header {
            width: 100%;
            padding: 20px 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .header-icons {
            position: absolute;
            left: 15px;
            display: flex;
            gap: 10px;
            font-size: 20px;
            color: #fff;
            opacity: 0.7;
        }

        .balance-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .coin-icon {
            color: #ffc107;
            font-size: 1.2em;
        }

        .game-title {
            text-align: center;
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 20px;
            width: 100%;
        }

        /* --- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© --- */
        .game-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 20px;
            padding-bottom: 120px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³ÙÙ„ÙŠØ© */
        }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù„Ø¹Ø¨Ø© */
        .game-board {
            display: flex;
            flex-direction: column-reverse;
            gap: 12px;
            width: 100%;
            max-width: 350px;
        }

        .row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            padding: 0 10px;
        }

        /* Ø§Ù„ØµÙ Ø§Ù„Ù†Ø´Ø· */
        .row.active::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 105%;
            height: 105%;
            background: rgba(100, 255, 100, 0.15);
            border-radius: 15px;
            z-index: 0;
            pointer-events: none;
            box-shadow: 0 0 15px rgba(100, 255, 100, 0.3);
        }

        /* Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø¹Ø·Ù„Ø© */
        .row.disabled .cell {
            opacity: 0.6;
            pointer-events: none;
            filter: grayscale(20%);
        }

        /* Ø§Ù„Ø®Ù„ÙŠØ© (Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ©) */
        .cell {
            width: 60px;
            height: 60px;
            /* Ø®Ù„ÙÙŠØ© Ø®Ø´Ø¨ÙŠØ© Ø¯Ø§Ø¦Ø±ÙŠØ© (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¬Ø²Ø¡Ø§Ù‹ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©) */
            background: transparent; 
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
            transition: transform 0.2s;
        }
        
        .cell:hover { transform: scale(1.05); }

        /* Ø§Ù„ØµÙˆØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„ÙŠØ© */
        .cell img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: none;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* ØªØ£Ø«ÙŠØ± Ù‚ÙØ² */
        }

        /* Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø®Ø´Ø¨ÙŠØ©) Ù‚Ø¨Ù„ Ø§Ù„ÙƒØ´Ù */
        .cell::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            /* Ù‡Ù†Ø§ ÙŠØ¬Ø¨ ÙˆØ¶Ø¹ ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø®Ø´Ø¨ÙŠØ© Ø§Ù„ÙØ§Ø±ØºØ©ØŒ Ø­Ø§Ù„ÙŠØ§Ù‹ Ù†Ø³ØªØ®Ø¯Ù… Ù„ÙˆÙ† ØªÙ‚Ø±ÙŠØ¨ÙŠ */
            background: linear-gradient(145deg, #5a3a22, #3d2514);
            border-radius: 50%;
            box-shadow: inset 2px 2px 5px rgba(255,255,255,0.2), inset -2px -2px 5px rgba(0,0,0,0.5);
            z-index: -1;
        }
        
        .cell.revealed::before { display: none; } /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¹Ù†Ø¯ ÙƒØ´Ù Ø§Ù„ØµÙˆØ±Ø© */
        .cell.revealed img { display: block; }

        /* Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ (Multiplier) */
        .odds-label {
            position: absolute;
            left: -75px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: bold;
            width: 70px;
            text-align: right;
        }

        .row.active .odds-label {
            color: #fff;
            text-shadow: 0 0 5px #7cb342;
        }

        /* --- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³ÙÙ„ÙŠØ© --- */
        .controls {
            position: absolute;
            bottom: 0;
            width: 100%;
            padding: 20px;
            background: linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0));
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }

        .bet-input-container {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 5px 15px;
            width: 80%;
            justify-content: space-between;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .bet-btn {
            background: none; border: none; color: #fff; font-size: 20px; cursor: pointer; padding: 5px;
        }
        
        input[type="number"] {
            background: none; border: none; color: white; text-align: center; font-size: 18px; font-weight: bold; width: 80px; outline: none;
        }
        /* Ø¥Ø®ÙØ§Ø¡ Ø£Ø³Ù‡Ù… Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„Ù„Ø£Ø±Ù‚Ø§Ù… */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Start/Cashout) */
        .main-btn {
            width: 90%;
            padding: 15px;
            border: none;
            border-radius: 30px;
            font-size: 20px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: 0.2s;
            /* ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ Ø£Ø®Ø¶Ø± Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„ØµÙˆØ±Ø© */
            background: linear-gradient(180deg, #6dbf2c 0%, #4a9618 100%);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .main-btn:hover { filter: brightness(1.1); transform: translateY(-2px); }
        .main-btn:active { transform: translateY(1px); box-shadow: 0 2px 5px rgba(0,0,0,0.3); }

        button.cashout-btn { display: none; /* Ù…Ø®ÙÙŠ Ø­ØªÙ‰ ØªØ¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© */ }

        /* --- ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ© ÙˆØ§Ù„Ù†ÙˆØ§ÙØ° --- */
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .result-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 100;
            display: none; justify-content: center; align-items: center; flex-direction: column;
        }

        .result-box {
            background: linear-gradient(145deg, #2c3844, #1b242d);
            padding: 40px 30px; border-radius: 20px; text-align: center;
            border: 3px solid; min-width: 280px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .win { border-color: #6dbf2c; color: #6dbf2c; }
        .lose { border-color: #e53935; color: #e53935; }
        .result-title { font-size: 32px; margin-bottom: 10px; }
        .result-amount { font-size: 24px; color: #fff; }
    </style>
</head>
<body>
    <div id="app-container">
        <header>
            <div class="header-icons"><span>â“˜</span><span>âš™ï¸</span></div>
            <div class="balance-box"><span class="coin-icon">â—</span><span id="balance">95.00</span> UM</div>
            <div style="width: 50px;"></div> </header>

        <div class="game-title">APPLE OF FORTUNE</div>

        <div class="game-content">
            <div class="game-board" id="gameBoard"></div>
        </div>

        <div class="controls">
            <div class="bet-input-container">
                <button class="bet-btn" onclick="adjustBet(-1)">-</button>
                <input type="number" id="betAmount" value="10.00">
                <button class="bet-btn" onclick="adjustBet(1)">+</button>
            </div>
            <button class="main-btn" id="startBtn" onclick="startGame()">BET</button>
            <button class="main-btn cashout-btn" id="cashoutBtn" onclick="cashOut()">TAKE WIN!</button>
        </div>

        <div class="result-overlay" id="resultOverlay" onclick="closeResult()">
            <div class="result-box" id="resultBox">
                <h2 class="result-title" id="resultTitle"></h2>
                <p class="result-amount" id="resultMessage"></p>
                <p style="margin-top:20px; font-size:14px; opacity: 0.7;">Tap to continue</p>
            </div>
        </div>
    </div>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ---
        const ROWS = 10;
        const COLS = 5;
        // ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ… Ù„ØªØ·Ø§Ø¨Ù‚ Ø§Ù„ØµÙˆØ±Ø© ØªÙ…Ø§Ù…Ø§Ù‹
        const ODDS = [4.02, 6.71, 11.18, 27.97, 69.93, 349.68, 1748.4, 8742.0, 43710, 218550];
        
        const IMG_APPLE = 'apple.png'; // ÙŠØ¬Ø¨ ØªÙˆÙÙŠØ± ØµÙˆØ±Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡
        const IMG_ROTTEN = 'rotten.png'; // ÙŠØ¬Ø¨ ØªÙˆÙÙŠØ± ØµÙˆØ±Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø£ÙƒÙˆÙ„Ø©

        let currentRow = 0;
        let isGameActive = false;
        let currentBet = 0;
        let balance = 95.00; // Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©
        let gameData = [];

        const boardEl = document.getElementById('gameBoard');
        const startBtn = document.getElementById('startBtn');
        const cashoutBtn = document.getElementById('cashoutBtn');
        const balanceEl = document.getElementById('balance');
        const betInput = document.getElementById('betAmount');

        // Ø¯Ø§Ù„Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø±Ù‡Ø§Ù†
        function adjustBet(change) {
            if (isGameActive) return;
            let currentVal = parseFloat(betInput.value) || 0;
            currentVal += change;
            if (currentVal < 1) currentVal = 1;
            betInput.value = currentVal.toFixed(2);
        }

        function initBoard() {
            boardEl.innerHTML = '';
            for (let r = ROWS - 1; r >= 0; r--) {
                const rowEl = document.createElement('div');
                rowEl.className = 'row disabled';
                rowEl.id = `row-${r}`;
                
                const oddsLabel = document.createElement('div');
                oddsLabel.className = 'odds-label';
                // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù„ØªØ·Ø§Ø¨Ù‚ Ø§Ù„ØµÙˆØ±Ø©
                oddsLabel.innerText = `x ${ODDS[r].toFixed(2)}`;
                rowEl.appendChild(oddsLabel);

                for (let c = 0; c < COLS; c++) {
                    const cellEl = document.createElement('div');
                    cellEl.className = 'cell';
                    cellEl.onclick = () => handleCellClick(r, c);
                    cellEl.id = `cell-${r}-${c}`;
                    
                    const img = document.createElement('img');
                    img.id = `img-${r}-${c}`;
                    cellEl.appendChild(img);

                    rowEl.appendChild(cellEl);
                }
                boardEl.appendChild(rowEl);
            }
        }

        function startGame() {
            const bet = parseFloat(betInput.value);
            if (bet > balance) { alert("Not enough balance!"); return; }
            if (bet <= 0 || isNaN(bet)) { alert("Invalid bet amount"); return; }

            balance -= bet;
            currentBet = bet;
            updateBalance();

            isGameActive = true;
            currentRow = 0;
            generateGameLogic();
            resetVisuals();

            startBtn.style.display = 'none';
            cashoutBtn.style.display = 'none';
            betInput.parentElement.style.pointerEvents = 'none'; // ØªØ¹Ø·ÙŠÙ„ ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù‡Ø§Ù† Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨
            activateRow(0);
        }

        function generateGameLogic() {
            gameData = [];
            // Ù…Ù†Ø·Ù‚ ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ø§Ù„Ù…ØªØ²Ø§ÙŠØ¯Ø©
            for (let r = 0; r < ROWS; r++) {
                let bombCount = 1;
                if (r >= 3) bombCount = 2;
                if (r >= 6) bombCount = 3;
                if (r >= 8) bombCount = 4;

                let rowData = Array(COLS).fill('apple');
                for (let i = 0; i < bombCount; i++) {
                    let placed = false;
                    while (!placed) {
                        let randIndex = Math.floor(Math.random() * COLS);
                        if (rowData[randIndex] === 'apple') {
                            rowData[randIndex] = 'rotten';
                            placed = true;
                        }
                    }
                }
                gameData.push(rowData);
            }
        }

        function handleCellClick(r, c) {
            if (!isGameActive || r !== currentRow) return;

            const cell = document.getElementById(`cell-${r}-${c}`);
            const img = document.getElementById(`img-${r}-${c}`);
            const type = gameData[r][c];
            
            cell.classList.add('revealed');

            if (type === 'apple') {
                img.src = IMG_APPLE;
                // Ù†Øµ Ø¨Ø¯ÙŠÙ„ ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„ØµÙˆØ±Ø©
                img.onerror = function() { this.style.display='none'; cell.innerText='ğŸ'; cell.style.fontSize='28px'; };
                handleWin(r);
            } else {
                img.src = IMG_ROTTEN;
                img.onerror = function() { this.style.display='none'; cell.innerText='ğŸ›'; cell.style.fontSize='28px'; };
                handleLoss();
            }
        }

        function handleWin(r) {
            document.getElementById(`row-${r}`).classList.remove('active');
            document.getElementById(`row-${r}`).classList.add('disabled');
            currentRow++;
            
            const currentWin = (currentBet * ODDS[r]).toFixed(2);
            cashoutBtn.innerHTML = `TAKE ${currentWin} UM`;
            cashoutBtn.style.display = 'block';

            if (currentRow >= ROWS) cashOut();
            else activateRow(currentRow);
        }

        function handleLoss() {
            isGameActive = false;
            cashoutBtn.style.display = 'none';
            revealRow(currentRow);
            setTimeout(() => {
                showResult(false, 0);
                resetGameState();
            }, 1500);
        }

        function cashOut() {
            if (!isGameActive) return;
            let winAmount = 0;
            if (currentRow > 0) winAmount = currentBet * ODDS[currentRow - 1];

            balance += winAmount;
            updateBalance();
            isGameActive = false;
            
            showResult(true, winAmount);
            resetGameState();
            
            if (currentRow < ROWS) {
                document.getElementById(`row-${currentRow}`).classList.remove('active');
                document.getElementById(`row-${currentRow}`).classList.add('disabled');
            }
        }

        function resetGameState() {
            startBtn.style.display = 'block';
            cashoutBtn.style.display = 'none';
            betInput.parentElement.style.pointerEvents = 'auto';
        }

        function activateRow(r) {
            const row = document.getElementById(`row-${r}`);
            row.classList.remove('disabled');
            row.classList.add('active');
        }

        function resetVisuals() { initBoard(); }

        function revealRow(r) {
            for(let c=0; c<COLS; c++) {
                const cell = document.getElementById(`cell-${r}-${c}`);
                const img = document.getElementById(`img-${r}-${c}`);
                const type = gameData[r][c];
                
                if (!cell.classList.contains('revealed')) {
                    cell.classList.add('revealed');
                    cell.style.opacity = '0.5';
                    if (type === 'apple') img.src = IMG_APPLE;
                    else img.src = IMG_ROTTEN;
                }
            }
        }

        function updateBalance() { balanceEl.innerText = balance.toFixed(2); }

        function showResult(isWin, amount) {
            const overlay = document.getElementById('resultOverlay');
            const box = document.getElementById('resultBox');
            const title = document.getElementById('resultTitle');
            const msg = document.getElementById('resultMessage');

            overlay.style.display = 'flex';
            box.className = 'result-box ' + (isWin ? 'win' : 'lose');
            
            if (isWin) {
                title.innerText = 'YOU WIN!';
                msg.innerText = `+ ${amount.toFixed(2)} UM`;
            } else {
                title.innerText = 'GAME OVER';
                msg.innerText = 'Better luck next time!';
            }
        }

        function closeResult() { document.getElementById('resultOverlay').style.display = 'none'; }

        initBoard();
        updateBalance(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø£ÙˆÙ„ÙŠ
    </script>
</body>
</html>
