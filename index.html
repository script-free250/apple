<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Apple Of Fortune Replica</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Roboto', sans-serif; /* Ø®Ø· Ù…Ø´Ø§Ø¨Ù‡ Ù„Ù„Ø£ØµÙ„ */
        }

        body {
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Ø­Ø§ÙˆÙŠØ© ØªØ­Ø§ÙƒÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ù‡Ø§ØªÙ ØªÙ…Ø§Ù…Ø§Ù‹ */
        #app-container {
            width: 100%;
            max-width: 414px; /* Ø¹Ø±Ø¶ Ø¢ÙŠÙÙˆÙ† Ù‚ÙŠØ§Ø³ÙŠ */
            height: 100vh;
            position: relative;
            background-color: #0a150f;
            /* Ù‡Ù†Ø§ Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø®Ù„ÙÙŠØ© Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ */
            background-image: url('bg.png'); 
            background-size: cover;
            background-position: center bottom;
            display: flex;
            flex-direction: column;
        }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ) --- */
        header {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            background: rgba(0,0,0,0.3); /* Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© Ø¯Ø§ÙƒÙ†Ø© */
            z-index: 10;
        }

        .header-icons-left {
            display: flex;
            gap: 15px;
            color: #fff;
            font-size: 22px;
            opacity: 0.8;
        }

        /* ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø±ØµÙŠØ¯ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
        .balance-pill {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 6px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            color: #fff;
            font-size: 15px;
        }

        .plus-icon-yellow {
            color: #ffc107;
            font-size: 18px;
            font-weight: 900;
        }

        .header-icon-right {
            color: #fff;
            font-size: 22px;
            opacity: 0.8;
        }

        /* Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ­Øª Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .game-title {
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            margin-top: 5px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* --- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ (Ø§Ù„Ø´Ø¨ÙƒØ©) --- */
        .game-area-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px 10px;
            /* Ù…Ø³Ø§Ø­Ø© ÙƒØ¨ÙŠØ±Ø© ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
            padding-bottom: 220px; 
            position: relative;
        }

        .grid {
            display: flex;
            flex-direction: column-reverse; /* Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
            gap: 8px;
            /* ØªØµØºÙŠØ± Ø§Ù„Ø´Ø¨ÙƒØ© Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
            transform: scale(0.92); 
        }

        .row {
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            transition: 0.3s;
        }

        /* Ø§Ù„ØµÙÙˆÙ ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·Ø© ØªÙƒÙˆÙ† Ø¨Ø§Ù‡ØªØ© */
        .row.disabled {
            opacity: 0.6;
            pointer-events: none;
        }

        /* ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ù…Ø¶Ø§Ø¹ÙØ§Øª (Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± ÙÙŠ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ø±Ø¨ÙŠ) */
        .odds-capsule {
            position: absolute;
            left: -75px; /* Ø¥Ø²Ø§Ø­Ø© Ù„Ù„ÙŠØ³Ø§Ø± */
            background: #0d2b22; /* Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± Ø¯Ø§ÙƒÙ† Ø¬Ø¯Ø§Ù‹ */
            color: #fff;
            padding: 6px 0;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            width: 65px;
            text-align: center;
            border: 1px solid #1a3d32;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* ØªÙ…ÙŠÙŠØ² Ø§Ù„ØµÙ Ø§Ù„Ù†Ø´Ø· */
        .row.active .odds-capsule {
            background: #1b4d3e; /* Ù„ÙˆÙ† Ø£ÙØªØ­ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            border-color: #4caf50;
            color: #fff;
        }
        
        /* ÙˆÙ‡Ø¬ Ø®Ù„Ù Ø§Ù„ØµÙ Ø§Ù„Ù†Ø´Ø· */
        .row.active::after {
            content: '';
            position: absolute;
            top: -8px; bottom: -8px; left: -10px; right: -10px;
            background: radial-gradient(ellipse at center, rgba(255,255,100,0.15) 0%, transparent 70%);
            z-index: 0;
            border-radius: 20px;
        }

        /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ø®Ù„ÙŠØ© (Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø®Ø´Ø¨ÙŠØ©) --- */
        /* Ù‡Ø°Ø§ Ø§Ù„Ù€ CSS Ø§Ù„Ù…Ø¹Ù‚Ø¯ ÙŠØ±Ø³Ù… Ø´ÙƒÙ„ Ø§Ù„Ø®Ø´Ø¨ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ */
        .cell {
            width: 58px;
            height: 58px;
            border-radius: 50%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 1;
            /* Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ù„Ù…Ø³ Ø§Ù„Ø®Ø´Ø¨ ÙˆØ§Ù„Ø¥Ø¶Ø§Ø¡Ø© */
            background: 
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.1) 0%, transparent 50%), /* Ù„Ù…Ø¹Ø© Ø¹Ù„ÙˆÙŠØ© */
                radial-gradient(circle at 50% 50%, #6d4c35 0%, #3e2723 80%, #2a1b15 100%); /* ØªØ¯Ø±Ø¬ Ø¨Ù†ÙŠ Ø®Ø´Ø¨ÙŠ */
            border: 2px solid #2a1b15; /* Ø­Ø§ÙØ© Ø¯Ø§ÙƒÙ†Ø© */
            box-shadow: 
                inset 0 1px 2px rgba(255,255,255,0.2), /* Ø­Ø§ÙØ© Ø¯Ø§Ø®Ù„ÙŠØ© ÙØ§ØªØ­Ø© */
                0 4px 8px rgba(0,0,0,0.6); /* Ø¸Ù„ Ø®Ø§Ø±Ø¬ÙŠ */
            transition: transform 0.1s;
        }
        
        .cell:active { transform: scale(0.95); }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¹Ù†Ø¯ Ø§Ù„ÙÙˆØ² (Ø®Ø¶Ø±Ø§Ø¡) */
        .cell.revealed.good {
            /* ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø®Ø¶Ø± */
            background: 
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                linear-gradient(135deg, #2e7d32 20%, #1b5e20 100%);
            border-color: #1b5e20;
        }
        
        /* Ø¥Ø¶Ø§ÙØ© Ø²Ø®Ø±ÙØ© Ø§Ù„ÙˆØ±Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡ */
        .cell.revealed.good::before {
            content: '';
            position: absolute;
            width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='58' height='58' viewBox='0 0 100 100'%3E%3Cpath fill='none' stroke='rgba(255,255,255,0.1)' stroke-width='2' d='M50 10 C 20 40, 20 60, 50 90 C 80 60, 80 40, 50 10 Z' /%3E%3C/svg%3E");
            background-size: cover;
            opacity: 0.5;
            border-radius: 50%;
        }

        /* Ø§Ù„ØµÙˆØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„ÙŠØ© */
        .cell img {
            width: 85%;
            height: 85%;
            object-fit: contain;
            display: none; /* Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            z-index: 2;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.4)); /* Ø¸Ù„ Ù„Ù„ØµÙˆØ±Ø© Ù†ÙØ³Ù‡Ø§ */
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .cell.revealed img { display: block; }

        @keyframes popIn {
            0% { transform: scale(0.6); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* --- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³ÙÙ„ÙŠØ© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© --- */
        .bet-controls-panel {
            position: absolute;
            bottom: 50px; /* ÙÙˆÙ‚ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ ØªÙ…Ø§Ù…Ø§Ù‹ */
            left: 0;
            width: 100%;
            padding: 15px 20px;
            /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© Ù…ØªØ¯Ø±Ø¬Ø© */
            background: linear-gradient(to top, #151f28, #1b2630);
            display: flex;
            flex-direction: column;
            gap: 12px;
            border-radius: 20px 20px 0 0; /* Ø²ÙˆØ§ÙŠØ§ Ø¹Ù„ÙˆÙŠØ© Ù…Ø³ØªØ¯ÙŠØ±Ø© */
            box-shadow: 0 -5px 20px rgba(0,0,0,0.3);
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ù‡Ø§Ù† Ø§Ù„Ø³Ø±ÙŠØ¹ Ø§Ù„ØµÙØ±Ø§Ø¡ */
        .quick-bets-row {
            display: flex;
            gap: 10px;
        }

        .quick-btn-yellow {
            flex: 1;
            padding: 12px 5px;
            background: #ffc107; /* Ø£ØµÙØ± ÙØ§Ù‚Ø¹ */
            border: none;
            border-radius: 8px;
            color: #212121;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 3px 0 #c79100; /* Ø¸Ù„ ØµÙ„Ø¨ Ù„Ù„Ø²Ø± */
        }
        .quick-btn-yellow:active { transform: translateY(3px); box-shadow: 0 0 0 #c79100; }

        /* Ø­Ø§ÙˆÙŠØ© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‡Ø§Ù† Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠØ© */
        .bet-input-box {
            background: #2a343d;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            padding: 5px 15px;
            border: 1px solid #37424b;
        }

        .bet-input-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bet-input-field {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 22px;
            font-weight: bold;
            width: 100%;
            text-align: left; /* Ø§Ù„Ø±Ù‚Ù… Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± */
            outline: none;
        }

        .currency-label { color: #fff; font-weight: normal; font-size: 18px; }

        .bet-limits-text {
            text-align: left;
            color: #6d7a86;
            font-size: 11px;
            margin-top: 2px;
        }

        /* Ø²Ø± Ø§Ù„Ø±Ù‡Ø§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ± */
        .main-bet-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            color: #212121;
            /* ØªØ¯Ø±Ø¬ Ø£ØµÙØ±/Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
            background: linear-gradient(180deg, #ffca28 0%, #ff8f00 100%);
            box-shadow: 0 4px 0 #e65100;
            cursor: pointer;
        }
        .main-bet-btn:active { transform: translateY(4px); box-shadow: none; }

        /* Ù†Ù…Ø· Ø²Ø± Ø§Ù„Ø³Ø­Ø¨ (ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„ÙÙˆØ²) */
        .cashout-mode {
            background: linear-gradient(180deg, #66bb6a 0%, #43a047 100%);
            box-shadow: 0 4px 0 #2e7d32;
            color: #fff;
        }


        /* --- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ø§Ù„Ø«Ø§Ø¨Øª --- */
        .bottom-nav-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background: #0e161d; /* Ù„ÙˆÙ† Ø¯Ø§ÙƒÙ† Ø¬Ø¯Ø§Ù‹ */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 25px;
            border-top: 1px solid #1c252e;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fff;
            font-size: 14px;
            font-weight: 500;
            opacity: 0.9;
        }
        .nav-icon { font-size: 18px; }

    </style>
</head>
<body>

    <div id="app-container">
        <header>
            <div class="header-icons-left">
                <span>â“˜</span> 
                <span style="border: 2px dashed #fff; border-radius: 50%; padding: 0 4px; font-size: 14px;">BONUS</span>
            </div>
            
            <div class="balance-pill">
                <span class="plus-icon-yellow">+</span>
                <span id="balanceDisplay">95 UM</span>
            </div>
            
            <div class="header-icon-right">
                <span>â†’</span>
            </div>
        </header>

        <div class="game-title">APPLE OF FORTUNE</div>

        <div class="game-area-container">
            <div class="grid" id="grid">
                </div>
        </div>

        <div class="bet-controls-panel" id="betControls">
            <div class="quick-bets-row">
                <button class="quick-btn-yellow" onclick="setBet('min')">Ø£Ø¯Ù†Ù‰</button>
                <button class="quick-btn-yellow" onclick="setBet('half')">X/2</button>
                <button class="quick-btn-yellow" onclick="setBet('double')">X2</button>
                <button class="quick-btn-yellow" onclick="setBet('max')">Ø£Ù‚ØµÙ‰</button>
            </div>
            
            <div class="bet-input-box">
                <div class="bet-input-wrapper">
                    <input type="number" id="betInput" class="bet-input-field" value="20">
                    <span class="currency-label">UM</span>
                </div>
                <div class="bet-limits-text">min 10 UM - max 47546.93 UM</div>
            </div>

            <button id="mainActionBtn" class="main-bet-btn" onclick="handleGameAction()">Ø§Ù„Ø±Ù‡Ø§Ù†</button>
        </div>

        <div class="bottom-nav-bar">
            <div class="nav-item">
                <span class="nav-icon">âš¡</span> Ø¨Ù€Ù†Ù€Ù‚Ù€Ø±Ø© ÙˆØ§Ø­Ù€Ø¯Ø©
            </div>
            <div class="nav-item">
                <span class="nav-icon">âš™ï¸</span> Ø¥Ø¹Ù€Ø¯Ø§Ø¯Ø§Øª
            </div>
        </div>
    </div>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© (Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ØµÙˆØ±) ---
        const ROWS = 10;
        const COLS = 5;
        // Ù‚ÙŠÙ… Ø§Ù„Ù…Ø¶Ø§Ø¹ÙØ§Øª ÙƒÙ…Ø§ ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©
        const ODDS = [4.02, 6.71, 11.18, 27.97, 69.93, 349.68, 1748.4, 8742.0, 43710, 218550];
        const MIN_BET = 10;
        const MAX_BET = 47546.93;

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        let balance = 95.00; // Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ
        let currentBetAmount = 20;
        let currentRowIndex = 0;
        let gameIsActive = false;
        let gameBoardLogic = []; // Ù„ØªØ®Ø²ÙŠÙ† Ø£Ù…Ø§ÙƒÙ† Ø§Ù„ØªÙØ§Ø­ ÙˆØ§Ù„Ù‚Ù†Ø§Ø¨Ù„

        // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        const gridContainer = document.getElementById('grid');
        const mainBtn = document.getElementById('mainActionBtn');
        const balanceLabel = document.getElementById('balanceDisplay');
        const betInputField = document.getElementById('betInput');
        const controlsPanel = document.getElementById('betControls');

        // --- Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ---

        // Ø±Ø³Ù… Ø§Ù„Ø´Ø¨ÙƒØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function initializeBoard() {
            gridContainer.innerHTML = '';
            for (let r = 0; r < ROWS; r++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'row disabled'; // Ø§Ù„ØµÙÙˆÙ Ù…Ø¹Ø·Ù„Ø© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                rowDiv.id = `row-${r}`;

                // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ù…Ø¶Ø§Ø¹Ù Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±
                const oddsDiv = document.createElement('div');
                oddsDiv.className = 'odds-capsule';
                oddsDiv.innerText = 'x ' + ODDS[r];
                rowDiv.appendChild(oddsDiv);

                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø®Ù…Ø³
                for (let c = 0; c < COLS; c++) {
                    const cellDiv = document.createElement('div');
                    cellDiv.className = 'cell'; // Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø§Ù„Ø®Ø´Ø¨ Ù…Ù† CSS
                    cellDiv.onclick = () => cellClicked(r, c);
                    
                    const cellImg = document.createElement('img');
                    cellImg.id = `cell-img-${r}-${c}`;
                    // Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„Ù„ØµÙˆØ± Ø§Ù„ØªÙŠ Ø³ØªØ¶Ø¹Ù‡Ø§
                    cellImg.src = ''; 
                    
                    cellDiv.appendChild(cellImg);
                    rowDiv.appendChild(cellDiv);
                }
                gridContainer.appendChild(rowDiv);
            }
        }

        // Ø§Ù„Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (ÙŠØ¹Ù…Ù„ ÙƒØ²Ø± Ø±Ù‡Ø§Ù† Ø£Ùˆ Ø²Ø± Ø³Ø­Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©)
        function handleGameAction() {
            if (!gameIsActive) {
                startGame();
            } else {
                cashOutWinnings();
            }
        }

        // Ø¨Ø¯Ø¡ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function startGame() {
            currentBetAmount = parseFloat(betInputField.value);
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ù‡Ø§Ù†
            if (isNaN(currentBetAmount) || currentBetAmount < MIN_BET || currentBetAmount > MAX_BET) {
                alert("Ø§Ù„Ø±Ù‡Ø§Ù† Ø®Ø§Ø±Ø¬ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©"); return;
            }
            if (currentBetAmount > balance) {
                alert("Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ"); return;
            }

            // Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯
            balance -= currentBetAmount;
            updateBalanceUI();
            
            gameIsActive = true;
            currentRowIndex = 0;
            createGameLogic(); // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„
            resetBoardVisuals(); // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙˆØ±Ø¯
            
            // Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ù‡Ø§Ù† Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨ (ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£ØµÙ„ÙŠ)
            controlsPanel.style.display = 'none';

            // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„
            enableRow(0);
        }

        // ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªÙØ§Ø­ ÙˆØ§Ù„Ù‚Ù†Ø§Ø¨Ù„ (Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø© ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹)
        function createGameLogic() {
            gameBoardLogic = [];
            for (let r = 0; r < ROWS; r++) {
                // Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„ ÙŠØ²ÙŠØ¯ ÙƒÙ„Ù…Ø§ ØµØ¹Ø¯Ù†Ø§
                let bombs = 1;
                if(r >= 4) bombs = 2;
                if(r >= 7) bombs = 3;
                if(r === 9) bombs = 4;

                let rowLogic = Array(COLS).fill('apple'); // Ø§Ù„ÙƒÙ„ ØªÙØ§Ø­ Ù…Ø¨Ø¯Ø¦ÙŠØ§Ù‹
                for(let k=0; k<bombs; k++) {
                    let placed = false;
                    while(!placed) {
                        let rnd = Math.floor(Math.random() * COLS);
                        if(rowLogic[rnd] === 'apple') {
                            rowLogic[rnd] = 'rotten';
                            placed = true;
                        }
                    }
                }
                gameBoardLogic.push(rowLogic);
            }
        }

        // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø®Ù„ÙŠØ©
        function cellClicked(r, c) {
            if (!gameIsActive || r !== currentRowIndex) return;

            const cell = document.getElementById(`cell-img-${r}-${c}`).parentElement;
            if (cell.classList.contains('revealed')) return; // Ù…Ù†Ø¹ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…ÙƒØ±Ø±

            revealResult(r, c);

            if (gameBoardLogic[r][c] === 'apple') {
                handleWin(r);
            } else {
                handleLoss();
            }
        }

        // ÙƒØ´Ù Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ù„ÙŠØ© (ØªÙØ§Ø­Ø© Ø£Ùˆ Ø¹Ù‚Ø¨)
        function revealResult(r, c) {
            const cell = document.getElementById(`cell-img-${r}-${c}`).parentElement;
            const img = document.getElementById(`cell-img-${r}-${c}`);
            cell.classList.add('revealed');

            if (gameBoardLogic[r][c] === 'apple') {
                cell.classList.add('good'); // ØªØªØ­ÙˆÙ„ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø®Ø¶Ø±Ø§Ø¡
                img.src = 'apple.png'; 
                // ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„ØµÙˆØ±Ø©ØŒ Ù†Ø¶Ø¹ Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù…Ø¤Ù‚Øª
                img.onerror = () => { cell.innerHTML = 'ğŸ'; cell.style.fontSize = '35px'; };
            } else {
                cell.classList.add('bad'); // ØªØ¨Ù‚Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ù†ÙŠØ©
                img.src = 'rotten.png';
                img.onerror = () => { cell.innerHTML = 'ğŸ›'; cell.style.fontSize = '35px'; };
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙˆØ² ÙÙŠ Ø§Ù„ØµÙ
        function handleWin(r) {
            const currentRow = document.getElementById(`row-${r}`);
            currentRow.classList.remove('active'); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø¹Ù† Ø§Ù„ØµÙ Ø§Ù„Ø­Ø§Ù„ÙŠ
            
            currentRowIndex++;
            let potentialWin = (currentBetAmount * ODDS[r]).toFixed(2);

            // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØªØºÙŠÙŠØ± Ø§Ù„Ø²Ø± Ø¥Ù„Ù‰ "Ø³Ø­Ø¨"
            controlsPanel.style.display = 'flex';
            mainBtn.innerText = `Ø³Ø­Ø¨ (${potentialWin} UM)`;
            mainBtn.classList.add('cashout-mode'); // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø²Ø± Ù„Ù„Ø£Ø®Ø¶Ø±

            if (currentRowIndex >= ROWS) {
                cashOutWinnings(); // Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù‚Ù…Ø©
            } else {
                enableRow(currentRowIndex); // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙ Ø§Ù„ØªØ§Ù„ÙŠ
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø®Ø³Ø§Ø±Ø©
        function handleLoss() {
            gameIsActive = false;
            revealFullRow(currentRowIndex); // ÙƒØ´Ù Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
            
            setTimeout(() => {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
                resetToInitialState();
            }, 1500);
        }

        // Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
        function cashOutWinnings() {
            if (!gameIsActive) return;
            
            // Ø§Ù„Ø±Ø¨Ø­ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø¢Ø®Ø± ØµÙ ØªÙ… ØªØ¬Ø§ÙˆØ²Ù‡ Ø¨Ù†Ø¬Ø§Ø­
            let winIndex = currentRowIndex - 1;
            let winAmount = currentBetAmount * ODDS[winIndex];
            
            balance += winAmount;
            updateBalanceUI();
            gameIsActive = false;
            
            alert(`Ù…Ø¨Ø±ÙˆÙƒ! Ø±Ø¨Ø­Øª ${winAmount.toFixed(2)} UM`);
            resetToInitialState();
        }

        // --- Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© ---
        function enableRow(r) {
            const row = document.getElementById(`row-${r}`);
            row.classList.remove('disabled');
            row.classList.add('active');
        }

        // ÙƒØ´Ù ÙƒØ§Ù…Ù„ Ø§Ù„ØµÙ Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø³Ø§Ø±Ø©
        function revealFullRow(r) {
            for(let c=0; c<COLS; c++) {
                const cell = document.getElementById(`cell-img-${r}-${c}`).parentElement;
                if(!cell.classList.contains('revealed')) {
                    revealResult(r, c);
                    cell.style.opacity = '0.5'; // Ø¬Ø¹Ù„ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ ØºÙŠØ± Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø§Ù‡ØªØ©
                }
            }
        }

        function resetBoardVisuals() { initializeBoard(); }

        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ù‚Ø¨Ù„ Ø§Ù„Ø±Ù‡Ø§Ù†)
        function resetToInitialState() {
            controlsPanel.style.display = 'flex';
            mainBtn.innerText = "Ø§Ù„Ø±Ù‡Ø§Ù†";
            mainBtn.classList.remove('cashout-mode');
            // ØªØ¹Ø·ÙŠÙ„ ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ
            document.querySelectorAll('.row').forEach(row => {
                row.classList.remove('active');
                row.classList.add('disabled');
            });
        }

        function updateBalanceUI() {
            balanceLabel.innerText = balance.toFixed(0) + ' UM'; // Ø¹Ø±Ø¶ Ø¨Ø¯ÙˆÙ† ÙƒØ³ÙˆØ± ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ù‡Ø§Ù† Ø§Ù„Ø³Ø±ÙŠØ¹
        function setBet(type) {
            let val = parseFloat(betInputField.value) || MIN_BET;
            switch(type) {
                case 'min': val = MIN_BET; break;
                case 'half': val = Math.max(MIN_BET, val / 2); break;
                case 'double': val = Math.min(MAX_BET, val * 2); break;
                case 'max': val = MAX_BET; break;
            }
            betInputField.value = val.toFixed(0); // Ø¹Ø±Ø¶ Ø±Ù‚Ù… ØµØ­ÙŠØ­
        }

        // ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        initializeBoard();
    </script>
</body>
</html>
