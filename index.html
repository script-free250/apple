<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MelBet Crash Simulator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

        :root {
            --bg-dark: #0f1923;
            --bg-panel: #1b242d;
            --bg-card: #242f3e;
            --yellow-accent: #f5a623;
            --green-accent: #5da034;
            --red-accent: #e94848;
            --text-white: #ffffff;
            --text-gray: #9aa8b9;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-dark);
            color: var(--text-white);
            font-family: 'Roboto', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        .header {
            height: 60px;
            background-color: #111;
            display: flex;
            flex-direction: column;
        }
        .header-top {
            height: 30px;
            background-color: var(--yellow-accent);
            display: flex;
            align-items: center;
            padding: 0 20px;
            color: #000;
            font-weight: bold;
            font-size: 14px;
            justify-content: space-between;
        }
        .header-nav {
            height: 30px;
            background-color: #222;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 20px;
            font-size: 12px;
        }

        /* --- Main Layout --- */
        .main-wrapper {
            display: flex;
            flex: 1;
            height: calc(100vh - 60px);
        }

        /* --- Left Side: Game + Controls --- */
        .game-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            gap: 10px;
            position: relative;
        }

        /* Game Monitor (Canvas) */
        .monitor-container {
            flex: 2; /* يأخذ مساحة أكبر */
            background-color: #161f2c;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
            border: 1px solid #333;
            /* خلفية تحاكي الجبال */
            background-image: linear-gradient(to top, #161f2c 0%, #1e2c3b 100%);
        }

        /* Mountains Silhouette Effect */
        .mountains-bg {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30%;
            background: url('https://i.imgur.com/JjOcaqH.png') repeat-x bottom; /* صورة تقريبية للجبال */
            background-size: contain;
            opacity: 0.3;
            z-index: 0;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Multiplier Text in Center */
        .multiplier-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            font-weight: 900;
            color: #fff;
            z-index: 10;
            text-shadow: 0 0 20px rgba(0,0,0,0.5);
            font-variant-numeric: tabular-nums;
        }
        .crashed { color: var(--red-accent) !important; }

        /* --- Betting Controls (Bottom) --- */
        .controls-container {
            height: 180px; /* ارتفاع ثابت للوحة التحكم */
            display: flex;
            gap: 10px;
        }

        .bet-panel {
            flex: 1;
            background-color: var(--bg-card);
            border-radius: 5px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border: 1px solid #333;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-gray);
            margin-bottom: 5px;
        }
        
        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        .switch-bg {
            width: 30px;
            height: 16px;
            background: #111;
            border-radius: 10px;
            position: relative;
        }
        .switch-bg::after {
            content: '';
            position: absolute;
            left: 2px; top: 2px;
            width: 12px; height: 12px;
            background: #666;
            border-radius: 50%;
            transition: 0.2s;
        }
        .toggle-switch.active .switch-bg { background: var(--green-accent); }
        .toggle-switch.active .switch-bg::after { left: 16px; background: #fff; }

        /* Inputs Row */
        .bet-row {
            display: flex;
            gap: 10px;
            height: 100%;
        }

        .bet-input-col {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .input-wrapper {
            background: #0b1219;
            border: 1px solid #333;
            border-radius: 4px;
            display: flex;
            align-items: center;
            height: 45px;
            padding: 0 5px;
        }
        .input-btn {
            width: 30px;
            height: 30px;
            background: transparent;
            border: 1px solid #333;
            color: #fff;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
        }
        .bet-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        .quick-amounts {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
        }
        .quick-btn {
            background: #1b242d;
            border: 1px solid #333;
            color: #fff;
            padding: 5px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        .quick-btn:hover { background: #333; }

        /* Big Orange Button */
        .place-bet-btn {
            width: 140px;
            background: linear-gradient(to bottom, #ffb84d, #f5a623);
            border: none;
            border-radius: 5px;
            color: #fff;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 0 #bf7c0e;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-shadow: 1px 1px 0 rgba(0,0,0,0.3);
        }
        .place-bet-btn span { font-size: 10px; font-weight: normal; margin-top: 5px; opacity: 0.9; }
        .place-bet-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #bf7c0e; }
        
        .cashout-style {
            background: linear-gradient(to bottom, #75c949, #5da034) !important;
            box-shadow: 0 4px 0 #3d701f !important;
        }

        /* --- Right Sidebar --- */
        .sidebar {
            width: 350px;
            background-color: var(--bg-panel);
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            background: var(--red-accent);
            color: #fff;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 13px;
            border-top-left-radius: 8px; /* خدعة بصرية */
            margin: 5px;
            border-radius: 5px;
        }

        .bets-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .bets-table th {
            color: var(--text-gray);
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #333;
            font-weight: normal;
        }
        .bets-table td {
            padding: 6px 8px;
            border-bottom: 1px solid #2a3544;
            color: #fff;
            text-align: center;
        }
        .col-user { display: flex; align-items: center; gap: 5px; justify-content: flex-end; }
        .col-user img { width: 20px; height: 20px; border-radius: 50%; background: #555; }
        
        .mult-pill {
            background: rgba(255,255,255,0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
        }
        .mult-win { color: var(--green-accent); background: rgba(93, 160, 52, 0.2); }

        /* Loader Overlay */
        .loader-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 25, 35, 0.9);
            z-index: 20;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .progress-bar-bg {
            width: 200px;
            height: 4px;
            background: #333;
            margin-top: 10px;
            border-radius: 2px;
        }
        .progress-bar-fill {
            height: 100%;
            background: var(--red-accent);
            width: 100%;
            transition: width 0.1s linear;
        }

    </style>
</head>
<body>

    <div class="header">
        <div class="header-top">
            <div>MELBET <span style="font-size:10px; opacity:0.8;">SIMULATOR</span></div>
            <div>EGP 14,500.00</div>
        </div>
        <div class="header-nav">
            <span>الرياضات</span>
            <span>بث مباشر</span>
            <span style="color:var(--yellow-accent)">FAST GAMES</span>
            <span>كازينو</span>
        </div>
    </div>

    <div class="main-wrapper">
        <div class="game-section">
            
            <div class="monitor-container">
                <div class="mountains-bg"></div>
                
                <canvas id="gameCanvas"></canvas>
                
                <div id="multiplierDisplay" class="multiplier-display">1.00x</div>

                <div id="loadingOverlay" class="loader-overlay">
                    <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">جاري انتظار الجولة</div>
                    <div style="font-size: 40px; color: var(--red-accent);" id="countdownText">7</div>
                    <div class="progress-bar-bg"><div id="progressFill" class="progress-bar-fill"></div></div>
                </div>
            </div>

            <div class="controls-container">
                
                <div class="bet-panel">
                    <div class="panel-header">
                        <div class="toggle-switch">
                            <div class="switch-bg"></div>
                            <span>الرهان التلقائي</span>
                        </div>
                        <div class="toggle-switch">
                            <div class="switch-bg"></div>
                            <span>سحب تلقائي</span>
                        </div>
                    </div>
                    <div class="bet-row">
                        <div class="bet-input-col">
                            <div class="input-wrapper">
                                <button class="input-btn" onclick="updateBet(1, -5)">-</button>
                                <input type="number" id="betInput1" class="bet-input" value="10">
                                <button class="input-btn" onclick="updateBet(1, 5)">+</button>
                            </div>
                            <div class="quick-amounts">
                                <button class="quick-btn" onclick="setBet(1, 10)">10</button>
                                <button class="quick-btn" onclick="setBet(1, 50)">50</button>
                                <button class="quick-btn" onclick="setBet(1, 100)">100</button>
                                <button class="quick-btn" onclick="setBet(1, 500)">500</button>
                            </div>
                        </div>
                        <button id="btn1" class="place-bet-btn" onclick="placeBet(1)">
                            <div id="btnText1" style="font-size:16px;">وضع الرهان</div>
                            <span id="btnSub1">على الجولة التالية</span>
                        </button>
                    </div>
                </div>

                <div class="bet-panel">
                    <div class="panel-header">
                        <div class="toggle-switch">
                            <div class="switch-bg"></div>
                            <span>الرهان التلقائي</span>
                        </div>
                        <div class="toggle-switch">
                            <div class="switch-bg"></div>
                            <span>سحب تلقائي</span>
                        </div>
                    </div>
                    <div class="bet-row">
                        <div class="bet-input-col">
                            <div class="input-wrapper">
                                <button class="input-btn" onclick="updateBet(2, -5)">-</button>
                                <input type="number" id="betInput2" class="bet-input" value="20">
                                <button class="input-btn" onclick="updateBet(2, 5)">+</button>
                            </div>
                            <div class="quick-amounts">
                                <button class="quick-btn" onclick="setBet(2, 10)">10</button>
                                <button class="quick-btn" onclick="setBet(2, 50)">50</button>
                                <button class="quick-btn" onclick="setBet(2, 100)">100</button>
                                <button class="quick-btn" onclick="setBet(2, 500)">500</button>
                            </div>
                        </div>
                        <button class="place-bet-btn" style="opacity: 0.8; cursor: not-allowed;">
                            <div>وضع الرهان</div>
                            <span>على الجولة التالية</span>
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <div class="sidebar">
            <div class="sidebar-header">
                <span>عدد الرهانات: 842</span>
                <span>EGP 45200.50</span>
            </div>
            <div style="flex:1; overflow-y:auto;">
                <table class="bets-table">
                    <thead>
                        <tr>
                            <th style="text-align:right">اسم المستخدم</th>
                            <th>الفرض</th>
                            <th>الرهان</th>
                            <th>الأرباح</th>
                        </tr>
                    </thead>
                    <tbody id="betsBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const multDisplay = document.getElementById('multiplierDisplay');
        const loader = document.getElementById('loadingOverlay');
        const countText = document.getElementById('countdownText');
        const progFill = document.getElementById('progressFill');
        const btn1 = document.getElementById('btn1');
        const btnText1 = document.getElementById('btnText1');
        const btnSub1 = document.getElementById('btnSub1');
        const betsBody = document.getElementById('betsBody');

        // Images
        const planeImg = new Image();
        // صورة الطائرة الصفراء (MelBet Style)
        planeImg.src = 'https://cdn-icons-png.flaticon.com/512/7893/7893979.png'; 

        // State
        let state = 'IDLE'; // IDLE, COUNTDOWN, FLYING, CRASHED
        let multiplier = 1.00;
        let crashAt = 0;
        let time = 0;
        let animationId;
        let myBet = 0;
        let isBetting = false; // Player clicked bet for next round
        let inGame = false; // Player is currently flying
        
        // Resize
        function resize(){
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- Logic ---

        function startCountdown() {
            state = 'COUNTDOWN';
            loader.style.display = 'flex';
            multDisplay.style.display = 'none';
            multDisplay.classList.remove('crashed');
            
            // Generate Random Fake Bets
            generateFakeBets();

            let timeLeft = 7;
            countText.innerText = timeLeft;
            progFill.style.width = '100%';

            // Update button if bet placed
            if (isBetting) {
                btn1.style.background = '#e94848'; // Red for cancel/waiting
                btn1.style.boxShadow = '0 4px 0 #a02020';
                btnText1.innerText = "إلغاء الرهان";
                btnSub1.innerText = "انتظار البدء...";
            } else {
                resetBtn();
            }

            const interval = setInterval(() => {
                timeLeft--;
                countText.innerText = timeLeft;
                progFill.style.width = (timeLeft/7)*100 + '%';
                
                if(timeLeft <= 0) {
                    clearInterval(interval);
                    loader.style.display = 'none';
                    startGame();
                }
            }, 1000);
        }

        function startGame() {
            state = 'FLYING';
            multDisplay.style.display = 'block';
            multDisplay.style.color = '#fff';
            multDisplay.innerText = '1.00x';
            
            multiplier = 1.00;
            time = 0;
            // Crash Logic: 
            crashAt = (Math.random() * 5) + 1.1; 
            if(Math.random() > 0.9) crashAt = 10 + Math.random() * 20; // 10% chance for big win

            if (isBetting) {
                inGame = true;
                isBetting = false;
                // Change Button to Cashout
                btn1.className = "place-bet-btn cashout-style";
                btnText1.innerText = "سحب الأرباح";
                btnSub1.innerText = (document.getElementById('betInput1').value * 1).toFixed(2) + ' EGP';
            } else {
                btn1.style.background = '#e94848';
                btn1.style.boxShadow = 'none';
                btn1.style.opacity = '0.7';
                btnText1.innerText = "انتظر";
                btnSub1.innerText = "الجولة جارية";
                btn1.disabled = true;
            }

            loop();
        }

        function loop() {
            if (state !== 'FLYING') return;

            time += 0.016; // approx 60fps
            // Exponential growth formula approximation
            multiplier = 1.0 + (Math.pow(time, 2) * 0.05);

            multDisplay.innerText = multiplier.toFixed(2) + 'x';

            // Check if player in game to update cashout value
            if (inGame) {
                let currentWin = (document.getElementById('betInput1').value * multiplier);
                btnSub1.innerText = currentWin.toFixed(2) + ' EGP';
            }

            draw();

            if (multiplier >= crashAt) {
                crash();
            } else {
                animationId = requestAnimationFrame(loop);
            }
        }

        function draw() {
            ctx.clearRect(0,0, canvas.width, canvas.height);
            
            const w = canvas.width;
            const h = canvas.height;

            // Draw Grid Lines (optional for tech look)
            ctx.strokeStyle = 'rgba(255,255,255,0.05)';
            ctx.beginPath();
            for(let i=0; i<w; i+=100) { ctx.moveTo(i,0); ctx.lineTo(i,h); }
            for(let j=0; j<h; j+=100) { ctx.moveTo(0,j); ctx.lineTo(w,j); }
            ctx.stroke();

            // Calculate Plane Position
            // Curve starts at bottom left (0, h)
            // Ends somewhat top right-ish based on time
            
            let progress = Math.min(time / 8, 1); // Cap animation path
            
            let startX = 0; 
            let startY = h;
            
            // Bezier Control Points
            let cpX = w * 0.5;
            let cpY = h;
            
            let endX = w * 0.8; 
            let endY = h * 0.2; // Go up to 20% from top

            // Quadratic Bezier Formula
            let t = progress;
            let invT = 1 - t;
            
            let x = (invT * invT * startX) + (2 * invT * t * cpX) + (t * t * endX);
            let y = (invT * invT * startY) + (2 * invT * t * cpY) + (t * t * endY);

            // Draw Curve Trail
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.quadraticCurveTo(startX + (cpX - startX) * (t/1), startY, x, y);
            
            ctx.strokeStyle = '#f5a623';
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#f5a623';
            ctx.stroke();
            ctx.shadowBlur = 0; // Reset

            // Fill area under curve
            ctx.lineTo(x, h);
            ctx.lineTo(0, h);
            ctx.fillStyle = 'rgba(245, 166, 35, 0.1)';
            ctx.fill();

            // Draw Plane
            if (planeImg.complete) {
                ctx.save();
                ctx.translate(x, y);
                // Calculate Rotation
                // Derivative of quadratic bezier for angle is roughly linear here for visual
                let angle = -20 - (t * 40); // Start -20 deg, go to -60 deg
                ctx.rotate(angle * Math.PI / 180);
                
                // Draw Plane
                let pSize = 60;
                ctx.drawImage(planeImg, -pSize/2, -pSize/2, pSize, pSize);
                
                // Engine flame/glow
                ctx.beginPath();
                ctx.arc(-25, 5, 5, 0, Math.PI*2);
                ctx.fillStyle = '#fff';
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#fff';
                ctx.fill();
                
                ctx.restore();
            }
        }

        function crash() {
            state = 'CRASHED';
            cancelAnimationFrame(animationId);
            
            multDisplay.innerText = 'CRASHED\n' + multiplier.toFixed(2) + 'x';
            multDisplay.classList.add('crashed');
            
            if (inGame) {
                // Lost
                btn1.style.background = '#e94848';
                btn1.className = "place-bet-btn"; // Reset style
                btnText1.innerText = "خسارة";
                btnSub1.innerText = "-" + document.getElementById('betInput1').value;
            }
            inGame = false;
            
            // Wait then restart
            setTimeout(startCountdown, 3000);
        }

        // --- Interaction ---
        function updateBet(panel, val) {
            const input = document.getElementById('betInput'+panel);
            let v = parseInt(input.value) + val;
            if(v < 1) v = 1;
            input.value = v;
        }
        function setBet(panel, val) {
            document.getElementById('betInput'+panel).value = val;
        }

        function placeBet(panel) {
            if (panel !== 1) return; // Only panel 1 working for demo

            if (state === 'COUNTDOWN') {
                if (!isBetting) {
                    isBetting = true;
                    // Update UI in loop
                } else {
                    isBetting = false; // Cancel
                    resetBtn();
                }
            } else if (state === 'FLYING' && inGame) {
                // Cashout
                inGame = false;
                let win = (document.getElementById('betInput1').value * multiplier).toFixed(2);
                
                btn1.style.background = '#5da034';
                btn1.style.boxShadow = 'none';
                btnText1.innerText = "فوز!";
                btnSub1.innerText = win + " EGP";
                btn1.disabled = true;
                
                // Add to sidebar history
                addHistoryRow(multiplier, win);
            } else {
                // Clicking during crash or while idle, set for next round
                isBetting = true;
                btnText1.innerText = "تم الوضع";
                btnSub1.innerText = "للجولة التالية";
            }
        }

        function resetBtn() {
            btn1.className = "place-bet-btn";
            btn1.style.background = ""; // Reset gradient
            btn1.style.boxShadow = "";
            btn1.style.opacity = "1";
            btn1.disabled = false;
            btnText1.innerText = "وضع الرهان";
            btnSub1.innerText = "على الجولة التالية";
        }

        // --- Sidebar Fake Data ---
        function generateFakeBets() {
            betsBody.innerHTML = '';
            for(let i=0; i<15; i++) {
                let row = document.createElement('tr');
                let user = Math.floor(Math.random()*900000) + '***';
                let bet = (Math.random() * 500 + 10).toFixed(2);
                row.innerHTML = `
                    <td class="col-user">
                        ${user} <img src="https://cdn-icons-png.flaticon.com/128/3135/3135715.png">
                    </td>
                    <td>-</td>
                    <td>${bet}</td>
                    <td>-</td>
                `;
                betsBody.appendChild(row);
            }
        }

        function addHistoryRow(mult, win) {
            // Add user win to top of list
            let row = document.createElement('tr');
            row.style.background = "rgba(93, 160, 52, 0.2)";
            row.style.borderLeft = "3px solid #5da034";
            row.innerHTML = `
                <td class="col-user">أنت <img src="https://cdn-icons-png.flaticon.com/128/3135/3135715.png"></td>
                <td><span class="mult-pill mult-win">${mult.toFixed(2)}x</span></td>
                <td>${document.getElementById('betInput1').value}</td>
                <td style="color:#5da034; font-weight:bold;">${win}</td>
            `;
            betsBody.insertBefore(row, betsBody.firstChild);
        }

        // Start
        startCountdown();

    </script>
</body>
</html>
