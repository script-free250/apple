<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Apple Of Fortune</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@500;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ - ØªØ­Ø§ÙƒÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¬ÙˆØ§Ù„ */
        #app {
            width: 100%;
            max-width: 420px;
            height: 100vh;
            position: relative;
            background-color: #0a150f; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø¯Ø§ÙƒÙ† */
            /* Ø¶Ø¹ ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù‡Ù†Ø§ */
            background-image: url('bg.png'); 
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
        }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ) --- */
        header {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            background: rgba(0,0,0,0.2);
            z-index: 10;
        }

        .header-left, .header-right {
            display: flex;
            gap: 15px;
            color: #fff;
            font-size: 24px;
            opacity: 0.9;
        }

        .balance-container {
            background: rgba(40, 50, 40, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 6px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            color: #fff;
            font-size: 16px;
        }

        .plus-icon {
            color: #ffc107;
            font-size: 20px;
        }

        .game-title {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin-top: 10px;
            letter-spacing: 1px;
        }

        /* --- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ (Ø§Ù„Ø´Ø¨ÙƒØ©) --- */
        .game-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            padding-bottom: 160px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
            position: relative;
        }

        .grid {
            display: flex;
            flex-direction: column-reverse;
            gap: 10px;
            transform: scale(0.9); /* ØªØµØºÙŠØ± Ø·ÙÙŠÙ Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø´Ø§Ø´Ø© */
        }

        .row {
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        /* ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ù…Ø¶Ø§Ø¹ÙØ§Øª (Odds) */
        .odds-capsule {
            position: absolute;
            right: -70px; /* Ù„Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ù„Ù„ÙŠÙ…ÙŠÙ† ÙÙŠ RTL */
            background: #1e3c2e;
            color: #fff;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
            border: 1px solid #2a503a;
        }

        /* Ø§Ù„ØµÙ Ø§Ù„Ù†Ø´Ø· */
        .row.active .odds-capsule {
            background: #2a503a;
            border-color: #4caf50;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.6);
        }
        
        .row.active::before {
            content: '';
            position: absolute;
            top: -5px; bottom: -5px; left: -5px; right: -5px;
            background: rgba(76, 175, 80, 0.15);
            border-radius: 25px;
            z-index: 0;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.2);
        }

        /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ø®Ù„ÙŠØ© (Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø®Ø´Ø¨ÙŠØ©) --- */
        .cell {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 1;

            /* Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø®Ø´Ø¨ÙŠØ© */
            background: 
                radial-gradient(circle at 50% 50%, transparent 50%, rgba(0,0,0,0.3) 100%), /* Ø¸Ù„ Ø¯Ø§Ø®Ù„ÙŠ */
                linear-gradient(135deg, #5d4037 0%, #3e2723 100%); /* Ù„ÙˆÙ† Ø§Ù„Ø®Ø´Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
            border: 3px solid #2d1e17; /* Ø­Ø§ÙØ© Ø¯Ø§ÙƒÙ†Ø© */
            box-shadow: 
                inset 0 2px 3px rgba(255,255,255,0.1), /* Ø¥Ø¶Ø§Ø¡Ø© Ø¹Ù„ÙˆÙŠØ© */
                0 4px 8px rgba(0,0,0,0.5); /* Ø¸Ù„ Ø®Ø§Ø±Ø¬ÙŠ */
        }
        
        .cell:active { transform: scale(0.95); }

        /* Ø§Ù„ØµÙÙˆÙ ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·Ø© */
        .row.disabled .cell {
            opacity: 0.7;
            pointer-events: none;
        }

        /* Ø§Ù„ØµÙˆØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„ÙŠØ© */
        .cell img {
            width: 80%;
            height: 80%;
            object-fit: contain;
            display: none;
            z-index: 2;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Ù‚Ø§Ø¹Ø¯Ø© Ø®Ø¶Ø±Ø§Ø¡ Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ØªÙØ§Ø­Ø© Ø§Ù„Ø³Ù„ÙŠÙ…Ø© (ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©) */
        .cell.revealed.good::after {
            content: '';
            position: absolute;
            width: 85%; height: 85%;
            background: radial-gradient(circle, #43a047 30%, #2e7d32 90%);
            border-radius: 50%;
            z-index: 1;
            border: 2px solid #1b5e20;
        }

        .cell.revealed img { display: block; }

        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* --- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³ÙÙ„ÙŠØ© (Ø§Ù„Ø±Ù‡Ø§Ù†) --- */
        .bet-controls {
            position: absolute;
            bottom: 50px; /* ÙÙˆÙ‚ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ */
            left: 0;
            width: 100%;
            padding: 15px;
            background: linear-gradient(to top, #1b242d, rgba(27, 36, 45, 0.9));
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quick-bets {
            display: flex;
            gap: 8px;
        }

        .quick-btn {
            flex: 1;
            padding: 10px;
            background: #ffc107;
            border: none;
            border-radius: 8px;
            color: #000;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 3px 0 #c79100;
        }
        .quick-btn:active { transform: translateY(3px); box-shadow: none; }

        .bet-input-container {
            background: #2c3844;
            border: 1px solid #3d4a57;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bet-input {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 20px;
            font-weight: bold;
            width: 100%;
            text-align: left;
            outline: none;
        }

        .currency-label { color: #fff; font-weight: bold; font-size: 18px; }

        .bet-limits {
            text-align: center;
            color: #8997a5;
            font-size: 12px;
        }

        .main-action-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 20px;
            font-weight: bold;
            color: #000;
            background: linear-gradient(180deg, #ffca28 0%, #ff8f00 100%);
            box-shadow: 0 4px 0 #e65100;
        }
        .main-action-btn:active { transform: translateY(4px); box-shadow: none; }

        /* Ø²Ø± Ø§Ù„Ø³Ø­Ø¨ (ÙŠØ¸Ù‡Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨) */
        .cashout-btn-style {
            background: linear-gradient(180deg, #66bb6a 0%, #43a047 100%);
            box-shadow: 0 4px 0 #2e7d32;
            color: #fff;
            display: none;
        }
        .cashout-btn-style:active { transform: translateY(4px); box-shadow: none; }


        /* --- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ --- */
        .bottom-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background: #11181f;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            border-top: 1px solid #2c3844;
        }

        .bottom-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
            font-size: 14px;
            opacity: 0.8;
        }

    </style>
</head>
<body>

    <div id="app">
        <header>
            <div class="header-right">
                <span>â†’</span> </div>
            <div class="balance-container">
                <span class="plus-icon">+</span>
                <span id="balanceDisplay">105.00 UM</span>
            </div>
            <div class="header-left">
                <span>â“˜</span> <span>âš™ï¸</span>
            </div>
        </header>

        <div class="game-title">APPLE OF FORTUNE</div>

        <div class="game-area">
            <div class="grid" id="grid">
                </div>
        </div>

        <div class="bet-controls">
            <div class="quick-bets" id="quickBets">
                <button class="quick-btn" onclick="setBet('min')">Ø£Ø¯Ù†Ù‰</button>
                <button class="quick-btn" onclick="setBet('half')">X/2</button>
                <button class="quick-btn" onclick="setBet('double')">X2</button>
                <button class="quick-btn" onclick="setBet('max')">Ø£Ù‚ØµÙ‰</button>
            </div>
            
            <div class="bet-input-container" id="betInputBox">
                <input type="number" id="betAmount" class="bet-input" value="20">
                <span class="currency-label">UM</span>
            </div>
            
            <div class="bet-limits" id="betLimits">min 10 UM - max 47546.93 UM</div>

            <button id="actionBtn" class="main-action-btn" onclick="handleAction()">Ø§Ù„Ø±Ù‡Ø§Ù†</button>
        </div>

        <div class="bottom-bar">
            <div class="bottom-item">
                <span>âš¡</span> Ø¨Ù†Ù‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø©
            </div>
            <div class="bottom-item">
                <span>âš™ï¸</span> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </div>
        </div>
    </div>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ---
        const ROWS = 10;
        const COLS = 5;
        // Ø§Ù„Ù…Ø¶Ø§Ø¹ÙØ§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ØµÙˆØ±Ø©
        const ODDS = [4.02, 6.71, 11.18, 27.97, 69.93, 349.68, 1748.4, 8742.0, 43710, 218550];
        const MIN_BET = 10;
        const MAX_BET = 47546.93;

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø©
        let balance = 105.00;
        let currentBet = 20;
        let activeRow = 0;
        let isPlaying = false;
        let bombsMap = []; // Ø®Ø±ÙŠØ·Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„

        // Ø¹Ù†Ø§ØµØ± DOM
        const gridEl = document.getElementById('grid');
        const actionBtn = document.getElementById('actionBtn');
        const balanceEl = document.getElementById('balanceDisplay');
        const betInput = document.getElementById('betAmount');
        const quickBetsEl = document.getElementById('quickBets');
        const betInputBoxEl = document.getElementById('betInputBox');
        const betLimitsEl = document.getElementById('betLimits');

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ù„ØªØ­ÙƒÙ… ---

        // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø´Ø¨ÙƒØ©
        function initGrid() {
            gridEl.innerHTML = '';
            for (let r = 0; r < ROWS; r++) {
                const row = document.createElement('div');
                row.className = 'row disabled';
                row.id = `row-${r}`;

                // ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ù…Ø¶Ø§Ø¹Ù
                const oddsCap = document.createElement('div');
                oddsCap.className = 'odds-capsule';
                oddsCap.innerText = 'x ' + ODDS[r];
                row.appendChild(oddsCap);

                // Ø§Ù„Ø®Ù„Ø§ÙŠØ§
                for (let c = 0; c < COLS; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.onclick = () => onCellClick(r, c);
                    
                    const img = document.createElement('img');
                    img.id = `img-${r}-${c}`;
                    // Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ± - ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª
                    img.src = ''; 
                    img.alt = "ØªÙØ§Ø­Ø©"; // Ù†Øµ Ø¨Ø¯ÙŠÙ„
                    
                    cell.appendChild(img);
                    row.appendChild(cell);
                }
                gridEl.appendChild(row);
            }
        }

        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø²Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        function handleAction() {
            if (!isPlaying) {
                startGame();
            } else {
                cashOut();
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        function startGame() {
            currentBet = parseFloat(betInput.value);
            if (isNaN(currentBet) || currentBet < MIN_BET || currentBet > MAX_BET) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº Ø±Ù‡Ø§Ù† ØµØ­ÙŠØ­ Ø¶Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯.");
                return;
            }
            if (currentBet > balance) {
                alert("Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠ!");
                return;
            }

            balance -= currentBet;
            updateUI();
            
            isPlaying = true;
            activeRow = 0;
            generateBombs();
            resetVisuals();
            toggleBetControls(false); // Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ù‡Ø§Ù†

            activateRow(0);
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„ (Ù…Ù†Ø·Ù‚ Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ø§Ù„Ù…ØªØ²Ø§ÙŠØ¯Ø©)
        function generateBombs() {
            bombsMap = [];
            for (let r = 0; r < ROWS; r++) {
                let bombCount = 1;
                if(r >= 4) bombCount = 2;
                if(r >= 7) bombCount = 3;
                if(r >= 9) bombCount = 4;

                let rowArr = Array(COLS).fill('good');
                for(let k=0; k<bombCount; k++) {
                    let placed = false;
                    while(!placed) {
                        let idx = Math.floor(Math.random() * COLS);
                        if(rowArr[idx] === 'good') {
                            rowArr[idx] = 'bad';
                            placed = true;
                        }
                    }
                }
                bombsMap.push(rowArr);
            }
        }

        // Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙŠØ©
        function onCellClick(r, c) {
            if (!isPlaying || r !== activeRow) return;

            const cell = document.getElementById(`img-${r}-${c}`).parentElement;
            if (cell.classList.contains('revealed')) return;

            revealCell(r, c);

            if (bombsMap[r][c] === 'good') {
                winLevel(r);
            } else {
                gameOver();
            }
        }

        // ÙƒØ´Ù Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ù„ÙŠØ©
        function revealCell(r, c) {
            const cell = document.getElementById(`img-${r}-${c}`).parentElement;
            const img = document.getElementById(`img-${r}-${c}`);
            cell.classList.add('revealed');

            if (bombsMap[r][c] === 'good') {
                cell.classList.add('good');
                img.src = 'apple.png'; // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØµÙˆØ±Ø©
                img.onerror = () => { cell.innerHTML = 'ğŸ'; cell.style.fontSize = '30px'; };
            } else {
                cell.classList.add('bad');
                img.src = 'rotten.png'; // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØµÙˆØ±Ø©
                img.onerror = () => { cell.innerHTML = 'ğŸ›'; cell.style.fontSize = '30px'; };
            }
        }

        // Ø§Ù„ÙÙˆØ² Ø¨Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ
        function winLevel(r) {
            const currentRowEl = document.getElementById(`row-${r}`);
            currentRowEl.classList.remove('active');
            
            activeRow++;
            let profit = (currentBet * ODDS[r]).toFixed(2);

            // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø³Ø­Ø¨
            actionBtn.innerText = `Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (${profit} UM)`;
            actionBtn.classList.add('cashout-btn-style');

            if (activeRow >= ROWS) {
                cashOut(); // ÙÙˆØ² Ù†Ù‡Ø§Ø¦ÙŠ
            } else {
                activateRow(activeRow);
            }
        }

        // Ø§Ù„Ø®Ø³Ø§Ø±Ø©
        function gameOver() {
            isPlaying = false;
            revealAll(activeRow); // ÙƒØ´Ù Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙ
            setTimeout(() => {
                alert("Ø­Ø¸ Ø£ÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©!");
                resetGameUI();
            }, 1000);
        }

        // Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
        function cashOut() {
            if (!isPlaying) return;
            let winIdx = activeRow - 1;
            let winAmount = currentBet * ODDS[winIdx];
            
            balance += winAmount;
            isPlaying = false;
            updateUI();
            
            alert(`Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ø±Ø¨Ø­Øª ${winAmount.toFixed(2)} UM`);
            resetGameUI();
        }

        // --- Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ---
        function activateRow(r) {
            const row = document.getElementById(`row-${r}`);
            row.classList.remove('disabled');
            row.classList.add('active');
        }

        function revealAll(r) {
            for(let c=0; c<COLS; c++) {
                const cell = document.getElementById(`img-${r}-${c}`).parentElement;
                if(!cell.classList.contains('revealed')) revealCell(r, c);
                cell.style.opacity = '0.6';
            }
        }

        function resetVisuals() { initGrid(); }

        function resetGameUI() {
            toggleBetControls(true);
            actionBtn.innerText = "Ø§Ù„Ø±Ù‡Ø§Ù†";
            actionBtn.classList.remove('cashout-btn-style');
        }

        function toggleBetControls(show) {
            const displayStyle = show ? 'flex' : 'none';
            quickBetsEl.style.display = displayStyle;
            betInputBoxEl.style.display = displayStyle;
            betLimitsEl.style.display = displayStyle;
        }

        function updateUI() {
            balanceEl.innerText = balance.toFixed(2) + ' UM';
        }

        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ù‡Ø§Ù† Ø§Ù„Ø³Ø±ÙŠØ¹
        function setBet(type) {
            let val = parseFloat(betInput.value) || MIN_BET;
            switch(type) {
                case 'min': val = MIN_BET; break;
                case 'half': val = Math.max(MIN_BET, val / 2); break;
                case 'double': val = Math.min(MAX_BET, val * 2); break;
                case 'max': val = MAX_BET; break;
            }
            betInput.value = val.toFixed(2);
        }

        // Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
        initGrid();
    </script>
</body>
</html>
